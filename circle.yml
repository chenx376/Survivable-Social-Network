machine:
  environment:
    PATH: ${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin
    NODE_ENV: test
  node:
    version: 7.5.0

dependencies:
  pre:
    - npm install -g  gulp
    - npm install -g mocha
    - npm install:
        pwd: sv4-esn-services/
    - git remote add sv4-esn-services-heroku https://git.heroku.com/sv4-esn-services.git
    - git remote add sv4-esn-view-heroku https://git.heroku.com/sv4-esn-view.git
test:
  override:
    - gulp test:
        pwd: sv4-esn-services
    - if [[ -e test-results.xml ]]; then cp test-results.xml $CIRCLE_TEST_REPORTS/test-results.xml; fi:
        pwd: sv4-esn-services

deployment:
  prod:
    branch: production
    commands:
      - git subtree push --prefix sv4-esn-services sv4-esn-services-heroku production
      - git subtree push --prefix sv4-esn-view sv4-esn-view-heroku production
